import { lineString, polygon } from '@turf/helpers';

import { orderShapes } from '../../util/geometry/display';
import { listsToSets } from '../test_helpers/collections';

/**
 * Test group sorting of an empty collection
 */
test('orderShapes on empty collection', () => {
  expect(orderShapes([])).toStrictEqual([]);
});

/**
 * Test sorting of two shapes
 */
test.each([
  // Identical polylines
  [
    [
      lineString([
        [-1, -2],
        [1, 2],
      ]),
      lineString([
        [-1, -2],
        [1, 2],
      ]),
    ],
    [
      [
        lineString([
          [-1, -2],
          [1, 2],
        ]),
        lineString([
          [-1, -2],
          [1, 2],
        ]),
      ],
    ],
  ],
  // Non-identical polylines
  [
    [
      lineString([
        [-1, -2],
        [1, 3],
      ]),
      lineString([
        [-1, -2],
        [1, 2],
      ]),
    ],
    [
      [
        lineString([
          [-1, -2],
          [1, 3],
        ]),
        lineString([
          [-1, -2],
          [1, 2],
        ]),
      ],
    ],
  ],
  // Polyline and polygon
  [
    [
      polygon([
        [
          [-1, -2],
          [1, 2],
          [3, 4],
          [-1, -2],
        ],
      ]),
      lineString([
        [-1, -2],
        [1, 2],
      ]),
    ],
    [
      [
        polygon([
          [
            [-1, -2],
            [1, 2],
            [3, 4],
            [-1, -2],
          ],
        ]),
      ],
      [
        lineString([
          [-1, -2],
          [1, 2],
        ]),
      ],
    ],
  ],
  // Polyline and polygon in the other order
  [
    [
      lineString([
        [-1, -2],
        [1, 2],
      ]),
      polygon([
        [
          [-1, -2],
          [1, 2],
          [3, 4],
          [-1, -2],
        ],
      ]),
    ],
    [
      [
        polygon([
          [
            [-1, -2],
            [1, 2],
            [3, 4],
            [-1, -2],
          ],
        ]),
      ],
      [
        lineString([
          [-1, -2],
          [1, 2],
        ]),
      ],
    ],
  ],
  // Polygon and overlapping polygon with larger area
  [
    [
      polygon([
        [
          [-122.48772186279284, 37.76569970608566],
          [-122.47124237060535, 37.770313432165125],
          [-122.47639221191395, 37.75375696081841],
          [-122.48772186279284, 37.76569970608566],
        ],
      ]),
      polygon([
        [
          [-122.52789062499987, 37.775198240145706],
          [-122.48222869873035, 37.786594870352666],
          [-122.48119873046865, 37.74072631253068],
          [-122.52789062499987, 37.775198240145706],
        ],
      ]),
    ],
    [
      [
        polygon([
          [
            [-122.52789062499987, 37.775198240145706],
            [-122.48222869873035, 37.786594870352666],
            [-122.48119873046865, 37.74072631253068],
            [-122.52789062499987, 37.775198240145706],
          ],
        ]),
      ],
      [
        polygon([
          [
            [-122.48772186279284, 37.76569970608566],
            [-122.47124237060535, 37.770313432165125],
            [-122.47639221191395, 37.75375696081841],
            [-122.48772186279284, 37.76569970608566],
          ],
        ]),
      ],
    ],
  ],
  // Polygon and overlapping polygon with smaller area
  [
    [
      polygon([
        [
          [-122.52789062499987, 37.775198240145706],
          [-122.48222869873035, 37.786594870352666],
          [-122.48119873046865, 37.74072631253068],
          [-122.52789062499987, 37.775198240145706],
        ],
      ]),
      polygon([
        [
          [-122.48772186279284, 37.76569970608566],
          [-122.47124237060535, 37.770313432165125],
          [-122.47639221191395, 37.75375696081841],
          [-122.48772186279284, 37.76569970608566],
        ],
      ]),
    ],
    [
      [
        polygon([
          [
            [-122.52789062499987, 37.775198240145706],
            [-122.48222869873035, 37.786594870352666],
            [-122.48119873046865, 37.74072631253068],
            [-122.52789062499987, 37.775198240145706],
          ],
        ]),
      ],
      [
        polygon([
          [
            [-122.48772186279284, 37.76569970608566],
            [-122.47124237060535, 37.770313432165125],
            [-122.47639221191395, 37.75375696081841],
            [-122.48772186279284, 37.76569970608566],
          ],
        ]),
      ],
    ],
  ],
  // Identical polygons
  [
    [
      polygon([
        [
          [-122.52789062499987, 37.775198240145706],
          [-122.48222869873035, 37.786594870352666],
          [-122.48119873046865, 37.74072631253068],
          [-122.52789062499987, 37.775198240145706],
        ],
      ]),
      polygon([
        [
          [-122.52789062499987, 37.775198240145706],
          [-122.48222869873035, 37.786594870352666],
          [-122.48119873046865, 37.74072631253068],
          [-122.52789062499987, 37.775198240145706],
        ],
      ]),
    ],
    [
      [
        polygon([
          [
            [-122.52789062499987, 37.775198240145706],
            [-122.48222869873035, 37.786594870352666],
            [-122.48119873046865, 37.74072631253068],
            [-122.52789062499987, 37.775198240145706],
          ],
        ]),
        polygon([
          [
            [-122.52789062499987, 37.775198240145706],
            [-122.48222869873035, 37.786594870352666],
            [-122.48119873046865, 37.74072631253068],
            [-122.52789062499987, 37.775198240145706],
          ],
        ]),
      ],
    ],
  ],
  // Non-overlapping polygons
  [
    [
      polygon([
        [
          [-122.51381281231659, 37.7648884195989],
          [-122.49733494795402, 37.769502145678366],
          [-122.50247894950007, 37.75294567433164],
          [-122.51381281231659, 37.7648884195989],
        ],
      ]),
      polygon([
        [
          [-122.48841340413583, 37.78146046337685],
          [-122.44274538961918, 37.79285709358382],
          [-122.44173990409007, 37.746988535761844],
          [-122.48841340413583, 37.78146046337685],
        ],
      ]),
    ],
    [
      [
        polygon([
          [
            [-122.51381281231659, 37.7648884195989],
            [-122.49733494795402, 37.769502145678366],
            [-122.50247894950007, 37.75294567433164],
            [-122.51381281231659, 37.7648884195989],
          ],
        ]),
        polygon([
          [
            [-122.48841340413583, 37.78146046337685],
            [-122.44274538961918, 37.79285709358382],
            [-122.44173990409007, 37.746988535761844],
            [-122.48841340413583, 37.78146046337685],
          ],
        ]),
      ],
    ],
  ],
])('orderShapes on pairs of shapes', (elements, expectedAsLists) => {
  const expected = listsToSets(expectedAsLists);
  const actual = listsToSets(orderShapes(elements));
  expect(actual).toStrictEqual(expected);
});
